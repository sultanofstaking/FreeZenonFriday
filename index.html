<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FreeZenonFriday Lottery</title>
</head>
<body>
    <h1>FreeZenonFriday Lottery</h1>
    <button id="joinButton">Join Now</button>
    <p>First draw: April 4, 4:00 PM EDT. Prizes: 2.1 xZNN or 0.9 xZNN. No fee, just gas (~0.01 xZNN).</p>
    <p id="status"></p>

    <script src="https://cdn.jsdelivr.net/npm/web3@1.7.4/dist/web3.min.js"></script>
    <script>
        const contractAddress = "0xbF1d0383F67F454722441F7C9A4A6851D599D361";
        const abi = [
	{
		"inputs": [],
		"name": "enter",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "selectWinners",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "address",
				"name": "participant",
				"type": "address"
			}
		],
		"name": "NewEntry",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "newFee",
				"type": "uint256"
			}
		],
		"name": "setEntryFee",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "startCompetition",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "address",
				"name": "firstWinner",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "firstAmount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "address",
				"name": "secondWinner",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "secondAmount",
				"type": "uint256"
			}
		],
		"name": "WinnersSelected",
		"type": "event"
	},
	{
		"inputs": [],
		"name": "withdraw",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "Withdrawn",
		"type": "event"
	},
	{
		"stateMutability": "payable",
		"type": "receive"
	},
	{
		"inputs": [],
		"name": "entryFee",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "firstPrize",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getParticipantCount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "isActive",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "nextDrawTime",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "participants",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "secondPrize",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];

        const joinButton = document.getElementById("joinButton");
        const status = document.getElementById("status");

        joinButton.onclick = async () => {
            let provider = window.ethereum;
            if (!provider) {
                status.innerText = "Install MetaMask first! Get it at metamask.io.";
                return;
            }
            const web3 = new Web3(provider);
            try {
                await provider.request({ method: "eth_requestAccounts" });
                const accounts = await web3.eth.getAccounts();
                const chainId = await web3.eth.getChainId();
                console.log("Current Chain ID:", chainId);
                if (Number(chainId) !== 73405) {
                    status.innerText = "Switch MetaMask to Supernova (Chain ID: 73405)!";
                    return;
                }

                const contract = new web3.eth.Contract(abi, contractAddress);
                console.log("Contract Loaded:", contract);
                console.log("Available Methods:", Object.keys(contract.methods));

                if (!contract.methods.enter) {
                    status.innerText = "Error: 'enter' method not found in contract!";
                    console.error("Contract Methods Available:", Object.keys(contract.methods));
                    return;
                }

                status.innerText = "Joining lottery...";
                await contract.methods.enter().send({ from: accounts[0], value: web3.utils.toWei("0", "ether") });

                status.innerText = "You're in! Drawâ€™s April 4, 4 PM EDT.";
            } catch (error) {
                console.error(error);
                status.innerText = "Error: " + (error.message || "Something went wrong");
            }
        };
    </script>
</body>
</html>
