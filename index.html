<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FreeZenonFriday Lottery - Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        button {
            margin: 10px 0;
            padding: 8px 16px;
        }
        pre {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        #console {
            background-color: #2c3e50;
            color: #ffffff;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>FreeZenonFriday Lottery - Debug</h1>
    
    <h2>Contract Information</h2>
    <p>Contract Address: <span id="contractAddress">0xbF1d0383F67F454722441F7C9A4A6851D599D361</span></p>
    
    <h2>Actions</h2>
    <button id="connectButton">1. Connect Wallet</button>
    <button id="checkNetworkButton">2. Check Network</button>
    <button id="loadContractButton">3. Load Contract</button>
    <button id="checkMethodsButton">4. Check Contract Methods</button>
    <button id="enterLotteryButton">5. Enter Lottery</button>
    
    <h2>Console</h2>
    <div id="console"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/web3@1.7.4/dist/web3.min.js"></script>
    <script>
        // Utility to log to our console div
        function log(message, isError = false) {
            const console = document.getElementById('console');
            const entry = document.createElement('div');
            entry.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            if (isError) {
                entry.style.color = '#ff6b6b';
            }
            console.appendChild(entry);
            console.scrollTop = console.scrollHeight;
        }
        
        // Global variables
        let web3;
        let accounts;
        let contract;
        
        // Full contract ABI
        const abi = [
            {
                "inputs": [],
                "name": "enter",
                "outputs": [],
                "stateMutability": "payable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "selectWinners",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "stateMutability": "nonpayable",
                "type": "constructor"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": false,
                        "internalType": "address",
                        "name": "participant",
                        "type": "address"
                    }
                ],
                "name": "NewEntry",
                "type": "event"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "newFee",
                        "type": "uint256"
                    }
                ],
                "name": "setEntryFee",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "startCompetition",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": false,
                        "internalType": "address",
                        "name": "firstWinner",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "firstAmount",
                        "type": "uint256"
                    },
                    {
                        "indexed": false,
                        "internalType": "address",
                        "name": "secondWinner",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "secondAmount",
                        "type": "uint256"
                    }
                ],
                "name": "WinnersSelected",
                "type": "event"
            },
            {
                "inputs": [],
                "name": "withdraw",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": false,
                        "internalType": "address",
                        "name": "to",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "Withdrawn",
                "type": "event"
            },
            {
                "stateMutability": "payable",
                "type": "receive"
            },
            {
                "inputs": [],
                "name": "entryFee",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "firstPrize",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getParticipantCount",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "isActive",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "nextDrawTime",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "owner",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "name": "participants",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "secondPrize",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            }
        ];
        
        // 1. Connect Wallet
        document.getElementById('connectButton').addEventListener('click', async () => {
            try {
                if (!window.ethereum) {
                    throw new Error('MetaMask not installed!');
                }
                
                web3 = new Web3(window.ethereum);
                accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                
                log(`Connected! Account: ${accounts[0]}`);
            } catch (error) {
                log(`Error connecting: ${error.message}`, true);
            }
        });
        
        // 2. Check Network
        document.getElementById('checkNetworkButton').addEventListener('click', async () => {
            try {
                if (!web3) {
                    throw new Error('Please connect wallet first');
                }
                
                const chainId = await web3.eth.getChainId();
                log(`Current Chain ID: ${chainId}`);
                
                if (Number(chainId) !== 73405) {
                    log('Wrong network. Please switch to Supernova (Chain ID: 73405)', true);
                } else {
                    log('Correct network: Supernova');
                }
            } catch (error) {
                log(`Error checking network: ${error.message}`, true);
            }
        });
        
        // 3. Load Contract
        document.getElementById('loadContractButton').addEventListener('click', async () => {
            try {
                if (!web3) {
                    throw new Error('Please connect wallet first');
                }
                
                const contractAddress = document.getElementById('contractAddress').textContent;
                contract = new web3.eth.Contract(abi, contractAddress);
                
                log('Contract loaded successfully!');
            } catch (error) {
                log(`Error loading contract: ${error.message}`, true);
            }
        });
        
        // 4. Check Contract Methods
        document.getElementById('checkMethodsButton').addEventListener('click', async () => {
            try {
                if (!contract) {
                    throw new Error('Please load contract first');
                }
                
                // Check available methods
                log('Available methods in contract.methods:');
                const methodsArray = [];
                for (const key in contract.methods) {
                    if (typeof contract.methods[key] === 'function' && key !== 'constructor') {
                        methodsArray.push(key);
                    }
                }
                log(methodsArray.join(', '));
                
                // Specifically check for "enter" method
                const hasEnterMethod = 'enter' in contract.methods;
                log(`Does 'enter' method exist? ${hasEnterMethod}`);
                
                // Try to call a view function to test contract connection
                try {
                    const count = await contract.methods.getParticipantCount().call();
                    log(`Current participant count: ${count}`);
                    
                    const isActive = await contract.methods.isActive().call();
                    log(`Is competition active? ${isActive}`);
                } catch (callError) {
                    log(`Error calling view function: ${callError.message}`, true);
                }
            } catch (error) {
                log(`Error checking methods: ${error.message}`, true);
            }
        });
        
        // 5. Enter Lottery
        document.getElementById('enterLotteryButton').addEventListener('click', async () => {
            try {
                if (!contract || !accounts) {
                    throw new Error('Please connect wallet and load contract first');
                }
                
                log('Entering lottery...');
                
                // Use a different approach to access the method
                const enterMethod = contract.methods.enter();
                if (!enterMethod) {
                    throw new Error("Couldn't access enter method");
                }
                
                log('Sending transaction...');
                const result = await enterMethod.send({ 
                    from: accounts[0], 
                    value: web3.utils.toWei("0", "ether")
                });
                
                log(`Success! Transaction hash: ${result.transactionHash}`);
            } catch (error) {
                log(`Error entering lottery: ${error.message}`, true);
                
                // More detailed debugging
                if (error.message.includes('not a function')) {
                    log('Debug: Checking contract methods object type...', true);
                    log(`Type of contract.methods: ${typeof contract.methods}`);
                    log(`contract.methods keys: ${Object.keys(contract.methods)}`);
                }
            }
        });
        
        // Initialize logging
        log('Debug page loaded. Follow the numbered steps to test each part of the process.');
    </script>
</body>
</html>
